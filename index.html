<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Tennis Scheduler (Ability-Weighted)</title>
    <style>
        /* CSS for the input/management view */
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f9f9f9; }
        h1 { color: #333; }
        label { font-weight: bold; display: block; margin-top: 15px; }
        
        input[type="date"], button { 
            padding: 10px; 
            margin-bottom: 10px; 
            border-radius: 5px; 
            border: 1px solid #ccc; 
            font-size: 16px;
        }
        
        textarea { 
            padding: 10px; 
            margin-bottom: 10px; 
            border-radius: 5px; 
            border: 1px solid #ccc; 
            width: 100%; 
            box-sizing: border-box; /* Ensures padding doesn't break width */
            font-family: monospace;
        }
        
        button { 
            background-color: #4CAF50; 
            color: white; 
            cursor: pointer; 
            border: none; 
            margin-right: 10px; 
            padding: 12px 20px;
        }
        
        button:hover { background-color: #45a049; }
        
        .schedule-table { width: 100%; border-collapse: collapse; margin-top: 20px; background-color: white; }
        .schedule-table th, .schedule-table td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        .schedule-table th { background-color: #f2f2f2; }
        .sit-out { background-color: #ffe0e0; font-weight: bold; color: #d9534f; }
        .court-title { background-color: #e6f7ff; }
        .ability-note { font-size: 0.9em; color: #666; margin-bottom: 5px; font-style: italic; }
        .button-group { margin-top: 20px; padding: 10px 0; border-top: 1px solid #eee; }
        .error-msg { color: red; background-color: #ffeeee; padding: 10px; border: 1px solid red; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ðŸŽ¾ Weekly Tennis Scheduler</h1>

    <label for="sessionDate">Session Date:</label>
    <input type="date" id="sessionDate">

    <label for="playerList">Player List (Name, Ability):</label>
    <div class="ability-note">Example: Alex, 4, Ben, 3.5 (Ensure commas separate names and scores)</div>
    <textarea id="playerList" rows="6">Alex,4, Ben,3, Chloe,5, David,2, Emily,3, Finn,4, Grace,2, Hugo,5, Isaac,3, Jane,4, Karl,2, Leah,3, Mark,5, Nina,4, Owen,2, Pam,3, Quinn,4</textarea>

    <label for="courtNamesHour1">6:30 PM Courts (Comma separated):</label>
    <div class="ability-note">Example: 12, 13, 14, 15</div>
    <textarea id="courtNamesHour1" rows="1">1, 2, 3, 4</textarea>

    <label for="courtNamesHour2">7:30 PM Courts (Comma separated):</label>
    <div class="ability-note">Example: 5, 6, 7, 8, 9</div>
    <textarea id="courtNamesHour2" rows="1">5, 6, 7, 8, 9</textarea>

    <div class="button-group">
        <button id="btnGenerate" onclick="generateSchedule()">Generate & Save Roster</button>
        <button id="btnShare" onclick="showShareableSchedule()" style="background-color: #007bff;">View Shareable Page</button>
    </div>

    <div id="scheduleOutput"></div>

    <script>
        // --- CONSTANTS ---
        const STORAGE_KEY = 'tennisSchedulerPlayerList';

        // --- UTILITY FUNCTIONS ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- CORE SCHEDULING LOGIC ---
        function scheduleByAbility(playerPool, numCourts) {
            let schedule = [];
            let sittingOut = [];
            let playersToPlay = [];

            const maxPlayers = numCourts * 4;
            
            // Determine who plays
            if (playerPool.length > maxPlayers) {
                playersToPlay = playerPool.slice(0, maxPlayers);
                sittingOut = playerPool.slice(maxPlayers);
            } else {
                playersToPlay = playerPool;
            }

            // Sort by ability (High -> Low)
            playersToPlay.sort((a, b) => b.ability - a.ability);
            let availablePlayers = [...playersTo
